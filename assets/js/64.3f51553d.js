(window.webpackJsonp=window.webpackJsonp||[]).push([[64],{230:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"xss-cross-site-scripting-攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-cross-site-scripting-攻击"}},[t._v("#")]),t._v(" XSS (Cross Site Scripting)攻击")]),t._v(" "),a("blockquote",[a("p",[t._v("攻击者利用 Web 应用的漏洞或缺陷，向页面注入恶意的程序或代码攻击站点。\n如果页面在加载过程中执行了意料之外的程序或代码（js,css），可以认为受到了 CSS 攻击。")])]),t._v(" "),a("h2",{attrs:{id:"xss-危害"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-危害"}},[t._v("#")]),t._v(" XSS 危害")]),t._v(" "),a("ul",[a("li",[t._v("盗取 cookie("),a("code",[t._v("document cookie")]),t._v(")")]),t._v(" "),a("li",[t._v("使用 js 或 css 破坏页面正常结构与样式")]),t._v(" "),a("li",[t._v("流量劫持("),a("code",[t._v("window.location.href")]),t._v("定位到其他页面)")]),t._v(" "),a("li",[t._v("利用 iframe,ajax 或 Flash 等方式，以用户的身份执行操作，并且还可以进一步的进行"),a("a",{attrs:{href:"https://baike.baidu.com/item/CSRF/2735433?fr=aladdin",target:"_blank",rel:"noopener noreferrer"}},[t._v("CSRF"),a("OutboundLink")],1),t._v("攻击")]),t._v(" "),a("li",[t._v("获取并操作页面敏感数据")])]),t._v(" "),a("h2",{attrs:{id:"类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类型"}},[t._v("#")]),t._v(" 类型")]),t._v(" "),a("p",[a("img",{attrs:{src:"http://blog.nsfocus.net/wp-content/uploads/2017/09/3b58430793944a738ffaf20e4a0a1aed.png",alt:"xss类型"}})]),t._v(" "),a("h2",{attrs:{id:"dom-document-object-model-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dom-document-object-model-简介"}},[t._v("#")]),t._v(" DOM(Document Object Model)简介")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("DOM 概念\nDom 一种以树形方式展示页面元素的方法，可以被 Js 操作。")])]),t._v(" "),a("li",[a("p",[t._v("常用 Dom 方法\n"),a("img",{attrs:{src:"http://blog.nsfocus.net/wp-content/uploads/2017/09/8822e4f04ae50d78c321295a8574802d.png",alt:"dom方法"}})])]),t._v(" "),a("li",[a("p",[t._v("四个重要的 DOM 属性")]),t._v(" "),a("p",[a("code",[t._v("nodeName")]),t._v(" 规定节点名称。 - 只读 - 元素节点的 nodeName 和标签名相同 - 属性节点的 nodeName 和属性名相同 - 文本节点的 nodeName 始终是#text - 文档节点的 nodeName 始终是 document\n"),a("code",[t._v("nodeValue")]),t._v(" 规定节点的值 - 元素节点的 nodeValue 是 undefined 或 null - 文本节点的 nodeValue 是文本本身 - 属性节点的 nodeValue 是属性值\n"),a("code",[t._v("nodeType")]),t._v(" 返回节点的类型 - 只读\n"),a("code",[t._v("innerHTML")]),t._v(" 获取元素内容 - 可读可写，被引用次数最多，也最容易产生安全问题。")])]),t._v(" "),a("li",[a("p",[t._v("输入一般在哪")]),t._v(" "),a("p",[a("code",[t._v("Location")]),t._v("对象属性\n"),a("img",{attrs:{src:"http://blog.nsfocus.net/wp-content/uploads/2017/09/0e1665fdd991958bb232d36444f9b191.png",alt:"location"}})])])]),t._v(" "),a("h2",{attrs:{id:"xss-攻击类型"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击类型"}},[t._v("#")]),t._v(" XSS 攻击类型")]),t._v(" "),a("ol",[a("li",[t._v("反射型 XSS")])]),t._v(" "),a("h3",{attrs:{id:"前端-url-参数解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前端-url-参数解析"}},[t._v("#")]),t._v(" 前端 URL 参数解析")]),t._v(" "),a("pre",[a("code",[t._v('会被攻击的代码\n\n```js\nvar data = eval("(" + getUrlParams("data") + ")");\n```\n\n举个例子：正常页面连接\n`http://xss-example.com/index.html?data={}`\n\n攻击者包装后的链接\n\n`http://xss-example.com/index.html?data={alert(document.cookie)}`\n\n实际情况下不会这么明显，经过编码后的链接\n\n`http://xss-example.com/index.html?data=\\u0061\\u006c\\u0065\\u0072\\u0074(1)`\n\n解析 URL 参数不用 eval 可以避免上述攻击，下面的代码不用 eval 也不安全，获取 url 参数并且放在 a 标签的 href 里\n\n```js\nvar _href = getUrlParams("url");\n$("a").attr("href", _href);\n```\n\n此功能就会被攻击\n\n`http://xss-example.com/index.html?url=javascript:eval(alert(document.cookie))`\n\n编码之后的结果\n\n`http://xss-example.com/index.html?url=javascript:\\u0065\\u0076\\u0061\\u006c(\\u0061\\u006c\\u0065\\u0072\\u0074(document.cookie))`\n')])]),t._v(" "),a("h3",{attrs:{id:"后端-url-参数解析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端-url-参数解析"}},[t._v("#")]),t._v(" 后端 URL 参数解析")]),t._v(" "),a("pre",[a("code",[t._v("一个get请求\n\n`http://xss-example.com/index.html?name=<script>alert(document.cookie)<\/script>`\n\n如果后端不做处理的结果也是被盗取cookie\n")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[a("p",[t._v("存储型攻击")]),t._v(" "),a("p",[t._v("注入型攻击常见的地方就是含有表单提交的地方。例如一个"),a("code",[t._v("textarea")]),t._v("，前端输入值不做处理直接提交，然后后端写入数据库，前端再次查询原样展示攻击代码的时候页面就发生了存储型攻击")])])]),t._v(" "),a("p",[t._v("XSS 攻击流程：首先分析程序寻找漏洞，然后构建攻击代码，例如"),a("code",[t._v("<script>")]),t._v("标签，代码注入成功后，再寻找输出点就完成了。")]),t._v(" "),a("h2",{attrs:{id:"如何规避-xss-攻击"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#如何规避-xss-攻击"}},[t._v("#")]),t._v(" 如何规避 xss 攻击")]),t._v(" "),a("p",[t._v("简单的通过正则表达式判断 html 标记是不够的，因为输入点的情况变化多样，对 html 标记的限制也会降低产品可用性，再者这种判断会被关键字中加入空格、制表符以及其他 HTML 编码躲避。")]),t._v(" "),a("p",[t._v("控制好输入输出就可以规避 xss")]),t._v(" "),a("ul",[a("li",[t._v("对输入内容的特定字符进行编码，例如<>符号")]),t._v(" "),a("li",[t._v("对重要的 cookie 设置 httpOnly，防止通过"),a("code",[t._v("document.cookie")]),t._v("读取")]),t._v(" "),a("li",[t._v("将不可信的值输入 url 参数之前，进行"),a("code",[t._v("URLEncode")]),t._v("操作。从 URL 参数中获取值一定要经过格式检测（根据需要）")]),t._v(" "),a("li",[t._v("不要使用 Eval!!!，解析 JSON 使用"),a("code",[t._v("JSON.parse()")])]),t._v(" "),a("li",[t._v("后端也要过滤关键字符")])]),t._v(" "),a("p",[t._v("概括一下，主要还是编码和过滤两种手段应对，编码用于转义特殊符号，过滤是阻止特定标记、属性、事件。\n例如在百度百科搜索框里输入"),a("code",[t._v("<script>")]),t._v("，会被转义为&lt;script&gt;")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("encode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("str")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("str "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v(" str"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" str\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/</gm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&gt;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/>/gm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&lt;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v('/"/gm')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&quot;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token regex"}},[t._v("/'/gm")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"&apos;"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("自己写的函数可能覆盖不了各种情况，实际项目中推荐使用第三方 xss 库"),a("a",{attrs:{href:"https://github.com/leizongmin/js-xss",target:"_blank",rel:"noopener noreferrer"}},[t._v("xss"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=e.exports}}]);